<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Kanban Board</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    #board {
      display: flex;
      justify-content: space-around;
      gap: 20px;
      margin-top: 20px;
    }
    .column {
      flex: 1;
      background: #fff;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .column h2 {
      text-align: center;
    }
    .task {
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      cursor: grab;
      color: #fff;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .delete-btn {
      margin-left: 10px;
      background: rgba(0,0,0,0.3);
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      color: white;
      cursor: pointer;
    }
    form {
      text-align: center;
      margin-top: 20px;
    }
    input, select, button {
      margin: 5px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      cursor: pointer;
      background: #007bff;
      color: white;
      border: none;
    }
  </style>
</head>
<body>
  <h1>üìå Kanban Board</h1>

  <form id="taskForm">
    <input type="text" id="taskTitle" placeholder="–ù–æ–≤–∞ –∑–∞–¥–∞—á–∞" required>
    <select id="operator">
      <option value="1">–û–ø–µ—Ä–∞—Ç–æ—Ä 1</option>
      <option value="2">–û–ø–µ—Ä–∞—Ç–æ—Ä 2</option>
      <option value="3">–û–ø–µ—Ä–∞—Ç–æ—Ä 3</option>
      <option value="4">–û–ø–µ—Ä–∞—Ç–æ—Ä 4</option>
      <option value="5">–û–ø–µ—Ä–∞—Ç–æ—Ä 5</option>
      <option value="6">–û–ø–µ—Ä–∞—Ç–æ—Ä 6</option>
      <option value="7">–û–ø–µ—Ä–∞—Ç–æ—Ä 7</option>
      <option value="8">–û–ø–µ—Ä–∞—Ç–æ—Ä 8</option>
      <option value="9">–û–ø–µ—Ä–∞—Ç–æ—Ä 9</option>
      <option value="10">–û–ø–µ—Ä–∞—Ç–æ—Ä 10</option>
    </select>
    <button type="submit">–î–æ–¥–∞—Ç–∏</button>
  </form>

  <div id="board">
    <div class="column" data-status="todo">
      <h2>To Do</h2>
      <div class="tasks"></div>
    </div>
    <div class="column" data-status="inprogress">
      <h2>In Progress</h2>
      <div class="tasks"></div>
    </div>
    <div class="column" data-status="done">
      <h2>Done</h2>
      <div class="tasks"></div>
    </div>
  </div>

  <!-- Firebase SDK (v12 modular) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp, query, orderBy } 
      from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    // üîë –¢–≤—ñ–π Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAAyjPpdrT0DoxwnoKZTqBkKC8Ks7B2ALw",
      authDomain: "kanban2-49b88.firebaseapp.com",
      projectId: "kanban2-49b88",
      storageBucket: "kanban2-49b88.appspot.com",   // ‚úÖ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ
      messagingSenderId: "670006838931",
      appId: "1:670006838931:web:4ac2b4bfacf130e448ef66",
      measurementId: "G-30D976Q8KW"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const operatorColors = {
      1: "#ff5733",
      2: "#33c1ff",
      3: "#75ff33",
      4: "#f333ff",
      5: "#ffc133",
      6: "#33fff7",
      7: "#9d33ff",
      8: "#ff3380",
      9: "#3385ff",
      10: "#33ff57"
    };

    const board = document.getElementById("board");
    const form = document.getElementById("taskForm");
    const taskTitle = document.getElementById("taskTitle");
    const operatorSelect = document.getElementById("operator");

    // üìå –î–æ–¥–∞–≤–∞–Ω–Ω—è –∑–∞–¥–∞—á—ñ
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const title = taskTitle.value.trim();
      const operator = operatorSelect.value;
      if (title) {
        await addDoc(collection(db, "tasks"), {
          title,
          operator,
          status: "todo",
          created: serverTimestamp()
        });
        taskTitle.value = "";
      }
    });

    // üìå –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–∞–¥–∞—á
    function renderTask(task) {
      const div = document.createElement("div");
      div.className = "task";
      div.draggable = true;
      div.style.background = operatorColors[task.operator];
      div.dataset.id = task.id;
      div.innerHTML = `
        <span>${task.title}</span>
        <button class="delete-btn">‚úñ</button>
      `;

      // –í–∏–¥–∞–ª–µ–Ω–Ω—è
      div.querySelector(".delete-btn").addEventListener("click", async () => {
        await deleteDoc(doc(db, "tasks", task.id));
      });

      // Drag events
      div.addEventListener("dragstart", (e) => {
        e.dataTransfer.setData("id", task.id);
      });

      board.querySelector(`[data-status="${task.status}"] .tasks`).appendChild(div);
    }

    // üìå –°–ª—É—Ö–∞—á Firestore
    const q = query(collection(db, "tasks"), orderBy("created"));
    onSnapshot(q, snapshot => {
      document.querySelectorAll(".tasks").forEach(c => c.innerHTML = "");
      snapshot.forEach(docSnap => {
        renderTask({ id: docSnap.id, ...docSnap.data() });
      });
    });

    // üìå –ü–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –º—ñ–∂ –∫–æ–ª–æ–Ω–∫–∞–º–∏
    document.querySelectorAll(".column").forEach(col => {
      col.addEventListener("dragover", (e) => e.preventDefault());
      col.addEventListener("drop", async (e) => {
        e.preventDefault();
        const id = e.dataTransfer.getData("id");
        const status = col.dataset.status;
        await updateDoc(doc(db, "tasks", id), { status });
      });
    });
  </script>
</body>
</html>
